# 操作流程

## 1）使用edirect检索并下载所需要的PMID

for example

```shell
esearch -db pubmed -query "rice"
```

## 2）向PubMed提供PMID（改变NCBI3.sh的输入文件）下载数据

```shell
nohup bash ./NCBI3.sh & #后台执行
ps -ef|grep NCBI3.sh #查看进程
exit #断开服务器链接
```

## 3）调整好文件位置并根据情况调整输出后，执行main.py

（如果需要绘制词云，在步骤中需要关闭wordcloud函数的调用）

```python
conda activate term #进入虚拟环境
nohup python3 main.py &
```

## 4) 执行R脚本获取词云原数据和原图片

（我使用python处理语料库的效果没有R语言好，这一步就用了R语言）

（本步骤内容详见task2）

```R
library(tm)
library(wordcloud2)
setwd("D:\\junior_n\\NLP\\term\\data")
cname <- file.path("D:","junior_n","NLP","term","data","co_wordcloud")
docs <- Corpus(DirSource(cname))
tospace <- content_transformer(function(x,parttern)gsub(parttern," ",x))
docs <- tm_map(docs,removePunctuation)
docs <- tm_map(docs,tospace,'/')
docs <- tm_map(docs,tospace,'@')
docs <- tm_map(docs,tospace,'\\|')
docs <- tm_map(docs,tolower)
docs <- tm_map(docs,removeNumbers)
docs <- tm_map(docs,removeWords,stopwords("english"))
docs <- tm_map(docs, stemDocument)
docs <- tm_map(docs,PlainTextDocument)
dtm <- DocumentTermMatrix(docs)
freq <- colSums(as.matrix(dtm))
ord <- order(freq,decreasing = T)
test = freq[head(ord,500)]
d <- data.frame(word = names(test),freq = test)
write.table(d,"genia_freq.csv",row.names=FALSE,col.names=FALSE,sep=",")
                              
letterCloud(demoFreq,word = "稻",wordSize = 0.33)#本句存在bug，但是可以获取图片
```

## 5）向python提供矢量图和源数据，绘制词云

(关闭其它函数仅保留wordcloud函数，再次执行main.py即可)

```python
def wordcloud(dirpath,filename,pngname):
    word_freq = []
    csv_reader = csv.reader(open(dirpath+filename))
    for row in csv_reader:
        word_freq.append((row[0],int(row[1])))
    text=''
    for i in word_freq:
        text = text + (i[0]+' ')*i[1]
    cut = jieba.cut(text)
    string = ' '.join(cut)
    color_mask =imageio.imread(dirpath+pngname)
    wc = WordCloud(
                background_color="white",
                collocations=False,
                mask=color_mask) 
    wc.generate(string)
    wc.to_file(dirpath+'wc'+pngname)
```

